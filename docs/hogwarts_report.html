    <!DOCTYPE html>
    <html lang="pl">
    <head>
        <meta charset="UTF-8">
        <title>Hogwarts Database Report</title>
            <!-- Add Socket.IO client library -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                background-color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }
            h1, h2 {
                color: #1a237e;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
            }
            th, td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }
            th {
                background-color: #1a237e;
                color: white;
            }
            tr:nth-child(even) {
                background-color: #f8f9fa;
            }
            .section {
                margin: 30px 0;
                padding: 20px;
                background-color: white;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            .collapsible {
                background-color: #1a237e;
                color: white;
                cursor: pointer;
                padding: 18px;
                width: 100%;
                border: none;
                text-align: left;
                outline: none;
                font-size: 15px;
                border-radius: 5px;
                margin: 10px 0;
            }
            .active, .collapsible:hover {
                background-color: #0d47a1;
            }
            .content {
                padding: 0 18px;
                display: none;
                overflow: hidden;
                background-color: #f1f1f1;
                border-radius: 0 0 5px 5px;
            }
            .schema-img {
                max-width: 100%;
                height: auto;
                cursor: pointer;
                transition: transform 0.3s ease;
            }
            .schema-img:hover {
                transform: scale(1.05);
            }
            .visualization-img {
                max-width: 100%;
                height: auto;
                margin: 10px 0;
            }
            .wizard-section {
                background-color: #e3f2fd;
                padding: 20px;
                border-radius: 5px;
                margin: 20px 0;
            }
            .wizard-button {
                background-color: #1a237e;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                margin: 5px;
                font-size: 14px;
            }
            .wizard-button:hover {
                background-color: #0d47a1;
            }
            .error {
                color: #d32f2f;
                background-color: #ffebee;
                padding: 10px;
                border-radius: 5px;
                margin: 5px 0;
            }
            .success {
                color: #1b5e20;
                background-color: #e8f5e9;
                padding: 10px;
                border-radius: 5px;
                margin: 5px 0;
            }
                .progress-message {
                    padding: 5px;
                    margin: 2px 0;
                    font-family: monospace;
                    font-size: 14px;
                    color: #333;
                }
                .progress-message.error {
                    color: #d32f2f;
                    background-color: #ffebee;
                    border-left: 4px solid #d32f2f;
                }
                #progress-messages {
                    max-height: 300px;
                    overflow-y: auto;
                    padding: 10px;
                    background-color: #f5f5f5;
                    border-radius: 4px;
                    margin-top: 10px;
                }
                .button-group {
                    margin: 20px 0;
                }
                button {
                    margin: 5px;
                    padding: 8px 16px;
                    border: none;
                    border-radius: 4px;
                    background-color: #2196f3;
                    color: white;
                    cursor: pointer;
                    transition: background-color 0.3s;
                }
                button:hover {
                    background-color: #1976d2;
                }
                button:disabled {
                    background-color: #bdbdbd;
                    cursor: not-allowed;
                }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Hogwarts Database Report</h1>
            
            <!-- Database Statistics -->
            <button type="button" class="collapsible">Database Statistics</button>
            <div class="content">
                <table>
                    <tr>
                        <th>Table</th>
                        <th>Row Count</th>
                    </tr>
    
                    <tr>
                        <td>teachers</td>
                            <td id="teachers-count">111</td>
                    </tr>
        
                    <tr>
                        <td>houses</td>
                            <td id="houses-count">4</td>
                    </tr>
        
                    <tr>
                        <td>dormitories</td>
                            <td id="dormitories-count">110</td>
                    </tr>
        
                    <tr>
                        <td>students</td>
                            <td id="students-count">10000</td>
                    </tr>
        
                    <tr>
                        <td>subjects</td>
                            <td id="subjects-count">78</td>
                    </tr>
        
                    <tr>
                        <td>grades</td>
                            <td id="grades-count">579409</td>
                    </tr>
        
                    <tr>
                        <td>points</td>
                            <td id="points-count">30000</td>
                    </tr>
        
                    <tr>
                        <td>quidditch</td>
                            <td id="quidditch-count">38</td>
                    </tr>
        
                </table>
            </div>

            <!-- Database Schema -->
            <button type="button" class="collapsible">Database Schema</button>
            <div class="content">
                <h3>Entity Relationship Diagram</h3>
                <img src="HogwartRelations.png" alt="Database Relations" class="schema-img" onclick="window.open(this.src)">
                <h3>Database Schema</h3>
                <img src="schema.png" alt="Database Schema" class="schema-img" onclick="window.open(this.src)">
            </div>

            <!-- Visualizations -->
            <button type="button" class="collapsible">Visualizations</button>
            <div class="content">
                <h3>Students by House</h3>
                <img src="visualizations/students_by_house.png" alt="Students by House" class="visualization-img">
                <h3>Grades Distribution</h3>
                <img src="visualizations/grades_distribution.png" alt="Grades Distribution" class="visualization-img">
                <h3>Subjects Popularity</h3>
                <img src="visualizations/subjects_popularity.png" alt="Subjects Popularity" class="visualization-img">
                <h3>Points by House</h3>
                <img src="visualizations/points_by_house.png" alt="Points by House" class="visualization-img">
                <h3>Gender Distribution</h3>
                <img src="visualizations/gender_distribution.png" alt="Gender Distribution" class="visualization-img">
                <h3>Quidditch Teams</h3>
                <img src="visualizations/quidditch_teams.png" alt="Quidditch Teams" class="visualization-img">
            </div>

            <!-- Performance Analysis -->
            <button type="button" class="collapsible">Performance Analysis</button>
            <div class="content">
                <table>
                    <tr>
                        <th>Query Type</th>
                        <th>Description</th>
                        <th>Execution Time</th>
                        <th>Rows Processed</th>
                    </tr>
    
                    <tr class="success">
                        <td>Simple SELECT</td>
                        <td>Basic select query on students table</td>
                            <td id="simple-select-time">0.0113 seconds</td>
                        <td id="simple-select-rows">2137</td>
                    </tr>
        
                    <tr class="success">
                        <td>Complex JOIN</td>
                        <td>Complex join between students, grades, and subjects</td>
                            <td id="complex-join-time">0.0094 seconds</td>
                        <td id="complex-join-rows">1000</td>
                    </tr>
        
                    <tr class="success">
                        <td>Aggregation</td>
                        <td>Complex aggregation with grouping and having</td>
                            <td id="aggregation-time">0.0056 seconds</td>
                        <td id="aggregation-rows">4</td>
                    </tr>
        
                    <tr class="success">
                        <td>Nested Subquery</td>
                        <td>Complex nested subquery with multiple conditions</td>
                            <td id="nested-subquery-time">0.0012 seconds</td>
                            <td id="nested-subquery-rows">30</td>
                    </tr>
        
                    <tr class="error">
                        <td>Transaction - Batch Insert</td>
                        <td>Insert multiple grades with transaction control</td>
                        <td id="batch-insert-time">Error</td>
                        <td id="batch-insert-rows">0</td>
                    </tr>
        
                    <tr class="success">
                        <td>Transaction - Batch Update</td>
                        <td>Update multiple grades with transaction control</td>
                            <td id="batch-update-time">0.0281 seconds</td>
                        <td id="batch-update-rows">1000</td>
                    </tr>
        
                    <tr class="success">
                        <td>Transaction - Complex Delete</td>
                        <td>Delete with complex conditions and restore data</td>
                            <td id="complex-delete-time">0.2423 seconds</td>
                        <td id="complex-delete-rows">1000</td>
                    </tr>
        
                    <tr class="success">
                        <td>Full Table Scan Analysis</td>
                        <td>Analyze grade distribution with full table scan</td>
                            <td id="full-table-scan-time">0.0446 seconds</td>
                        <td id="full-table-scan-rows">6</td>
                    </tr>
        
                </table>
            </div>

            <!-- Data Wizard -->
            <button type="button" class="collapsible">Data Wizard 🧙‍♂️</button>
            <div class="content wizard-section">
                <h3>Generate and Manage Data</h3>
                <p>Use these magical buttons to manage your Hogwarts database:</p>
                <button onclick="generateConfig()" class="wizard-button">Generate Configuration 📝</button>
                <button onclick="generateData()" class="wizard-button">Generate Test Data 🎲</button>
                <button onclick="importData()" class="wizard-button">Import Data to Database 📥</button>
                <button onclick="clearDatabase()" class="wizard-button">Clear Database 🧹</button>
                <button onclick="runTests()" class="wizard-button">Run Performance Tests ⚡</button>
                <div id="wizardStatus"></div>
            </div>

            <div id="progress-messages"></div>

            <script>
                    let updateInterval;
                    let lastUpdate = 0;
                    const UPDATE_INTERVAL = 5000; // Update every 5 seconds

                    function updateStatistics() {
                        const now = Date.now();
                        if (now - lastUpdate < UPDATE_INTERVAL) {
                            return; // Skip if too soon
                        }
                        lastUpdate = now;

                        fetch('/run_tests')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! status: ${response.status}`);
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data.status === 'success') {
                                    // Update table counts
                                    document.getElementById('teachers-count').textContent = data.stats.teachers || 0;
                                    document.getElementById('houses-count').textContent = data.stats.houses || 0;
                                    document.getElementById('dormitories-count').textContent = data.stats.dormitories || 0;
                                    document.getElementById('students-count').textContent = data.stats.students || 0;
                                    document.getElementById('subjects-count').textContent = data.stats.subjects || 0;
                                    document.getElementById('grades-count').textContent = data.stats.grades || 0;
                                    document.getElementById('points-count').textContent = data.stats.points || 0;
                                    document.getElementById('quidditch-count').textContent = data.stats.quidditch_team_members || 0;

                                    // Update performance metrics
                                    if (data.performance) {
                                        const metrics = {
                                            'simple-select-time': data.performance.simple_select,
                                            'complex-join-time': data.performance.complex_join,
                                            'aggregation-time': data.performance.aggregation,
                                            'nested-subquery-time': data.performance.nested_subquery,
                                            'batch-insert-time': data.performance.batch_insert,
                                            'batch-update-time': data.performance.batch_update,
                                            'complex-delete-time': data.performance.complex_delete,
                                            'full-table-scan-time': data.performance.full_table_scan
                                        };

                                        for (const [id, value] of Object.entries(metrics)) {
                                            const element = document.getElementById(id);
                                            if (element && value !== undefined) {
                                                if (typeof value === 'number') {
                                                    element.textContent = `${value.toFixed(4)} seconds`;
                                                    // Jeśli test się powiódł, ustaw klasę success
                                                    element.parentElement.classList.remove('error');
                                                    element.parentElement.classList.add('success');
                                                } else if (typeof value === 'string' && value.startsWith('Error')) {
                                                    element.textContent = 'Error';
                                                    // Jeśli test się nie powiódł, ustaw klasę error
                                                    element.parentElement.classList.remove('success');
                                                    element.parentElement.classList.add('error');
                                                }
                                            }
                                        }

                                        // Aktualizuj liczby przetworzonych wierszy
                                        const rowMetrics = {
                                            'simple-select-rows': data.performance.simple_select_rows,
                                            'complex-join-rows': data.performance.complex_join_rows,
                                            'aggregation-rows': data.performance.aggregation_rows,
                                            'nested-subquery-rows': data.performance.nested_subquery_rows,
                                            'batch-insert-rows': data.performance.batch_insert_rows,
                                            'batch-update-rows': data.performance.batch_update_rows,
                                            'complex-delete-rows': data.performance.complex_delete_rows,
                                            'full-table-scan-rows': data.performance.full_table_scan_rows
                                        };

                                        for (const [id, value] of Object.entries(rowMetrics)) {
                                            const cells = document.querySelectorAll('table tr td');
                                            for (let i = 0; i < cells.length; i++) {
                                                if (cells[i].id === id) {
                                                    cells[i].textContent = value;
                                                    break;
                                                }
                                            }
                                        }
                                    }
                                } else {
                                    console.error('Error in response:', data.message);
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                console.error('Error updating statistics:', error);
                                addProgressMessage(`Error updating statistics: ${error.message}`, true);
                            });
                    }

                    function addProgressMessage(message, isError = false) {
                        const progressDiv = document.getElementById('progress-messages');
                        const messageElement = document.createElement('div');
                        messageElement.className = isError ? 'progress-message error' : 'progress-message';
                        messageElement.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                        progressDiv.appendChild(messageElement);
                        progressDiv.scrollTop = progressDiv.scrollHeight;
                    }

                    // Socket.IO connection
                    const socket = io();
                    socket.on('connect', () => {
                        console.log('Connected to server');
                        addProgressMessage('Connected to server');
                    });
                    socket.on('disconnect', () => {
                        console.log('Disconnected from server');
                        addProgressMessage('Disconnected from server', true);
                    });
                    socket.on('progress', function(data) {
                        if (data.type === 'progress') {
                            addProgressMessage(data.message, data.message.toLowerCase().includes('error'));
                        }
                    });

                    // Start periodic updates when page loads
                    document.addEventListener('DOMContentLoaded', function() {
                        updateStatistics();
                        updateInterval = setInterval(updateStatistics, UPDATE_INTERVAL);
                    });

                    // Clean up interval when page is unloaded
                    window.addEventListener('beforeunload', function() {
                        if (updateInterval) {
                            clearInterval(updateInterval);
                        }
                    });

                    // Add collapsible functionality
                var coll = document.getElementsByClassName("collapsible");
                for (var i = 0; i < coll.length; i++) {
                    coll[i].addEventListener("click", function() {
                        this.classList.toggle("active");
                        var content = this.nextElementSibling;
                        if (content.style.display === "block") {
                            content.style.display = "none";
                        } else {
                            content.style.display = "block";
                        }
                    });
                }

                    // Handle button clicks
                    document.getElementById('generate-data-btn').addEventListener('click', function() {
                        this.disabled = true;
                        addProgressMessage('Generating data...');
                        
                        fetch('/generate_data')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error generating data: ${error.message}`, true);
                            })
                            .finally(() => {
                                this.disabled = false;
                            });
                    });

                    // Add wizard functions
                    function generateConfig() {
                        const button = document.querySelector('button.wizard-button');
                        button.disabled = true;
                        addProgressMessage('Generating configuration...');
                        
                        fetch('/generate_config', { method: 'POST' })
                            .then(response => response.json())
                            .then(data => {
                        if (data.status === 'success') {
                                    addProgressMessage(data.message);
                        } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error generating configuration: ${error.message}`, true);
                            })
                            .finally(() => {
                                button.disabled = false;
                            });
                    }

                    function generateData() {
                        const button = document.querySelector('button.wizard-button:nth-child(2)');
                        button.disabled = true;
                        addProgressMessage('Generating data...');
                        
                        fetch('/generate_data')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error generating data: ${error.message}`, true);
                            })
                            .finally(() => {
                                button.disabled = false;
                            });
                    }

                    function importData() {
                        const button = document.querySelector('button.wizard-button:nth-child(3)');
                        button.disabled = true;
                        addProgressMessage('Importing data...');
                        
                        fetch('/import_data')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error importing data: ${error.message}`, true);
                            })
                            .finally(() => {
                                button.disabled = false;
                            });
                    }

                    function clearDatabase() {
                        const button = document.querySelector('button.wizard-button:nth-child(4)');
                        button.disabled = true;
                        addProgressMessage('Clearing database...');
                        
                        fetch('/clear_database', { method: 'POST' })
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error clearing database: ${error.message}`, true);
                            })
                            .finally(() => {
                                button.disabled = false;
                            });
                    }

                    function runTests() {
                        const button = document.querySelector('button.wizard-button:nth-child(5)');
                        button.disabled = true;
                        addProgressMessage('Running performance tests...');
                        
                        fetch('/run_tests')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage('Performance tests completed successfully!');
                                    
                                    // Aktualizuj statystyki na stronie
                                    // Update table counts
                                    document.getElementById('teachers-count').textContent = data.stats.teachers || 0;
                                    document.getElementById('houses-count').textContent = data.stats.houses || 0;
                                    document.getElementById('dormitories-count').textContent = data.stats.dormitories || 0;
                                    document.getElementById('students-count').textContent = data.stats.students || 0;
                                    document.getElementById('subjects-count').textContent = data.stats.subjects || 0;
                                    document.getElementById('grades-count').textContent = data.stats.grades || 0;
                                    document.getElementById('points-count').textContent = data.stats.points || 0;
                                    document.getElementById('quidditch-count').textContent = data.stats.quidditch_team_members || 0;

                                    // Update performance metrics
                                    if (data.performance) {
                                        const metrics = {
                                            'simple-select-time': data.performance.simple_select,
                                            'complex-join-time': data.performance.complex_join,
                                            'aggregation-time': data.performance.aggregation,
                                            'nested-subquery-time': data.performance.nested_subquery,
                                            'batch-insert-time': data.performance.batch_insert,
                                            'batch-update-time': data.performance.batch_update,
                                            'complex-delete-time': data.performance.complex_delete,
                                            'full-table-scan-time': data.performance.full_table_scan
                                        };

                                        for (const [id, value] of Object.entries(metrics)) {
                                            const element = document.getElementById(id);
                                            if (element && value !== undefined) {
                                                if (typeof value === 'number') {
                                                    element.textContent = `${value.toFixed(4)} seconds`;
                                                    // Jeśli test się powiódł, ustaw klasę success
                                                    element.parentElement.classList.remove('error');
                                                    element.parentElement.classList.add('success');
                                                } else if (typeof value === 'string' && value.startsWith('Error')) {
                                                    element.textContent = 'Error';
                                                    // Jeśli test się nie powiódł, ustaw klasę error
                                                    element.parentElement.classList.remove('success');
                                                    element.parentElement.classList.add('error');
                                                }
                                            }
                                        }

                                        // Aktualizuj liczby przetworzonych wierszy
                                        const rowMetrics = {
                                            'simple-select-rows': data.performance.simple_select_rows,
                                            'complex-join-rows': data.performance.complex_join_rows,
                                            'aggregation-rows': data.performance.aggregation_rows,
                                            'nested-subquery-rows': data.performance.nested_subquery_rows,
                                            'batch-insert-rows': data.performance.batch_insert_rows,
                                            'batch-update-rows': data.performance.batch_update_rows,
                                            'complex-delete-rows': data.performance.complex_delete_rows,
                                            'full-table-scan-rows': data.performance.full_table_scan_rows
                                        };

                                        for (const [id, value] of Object.entries(rowMetrics)) {
                                            const element = document.getElementById(id);
                                            if (element && value !== undefined) {
                                                element.textContent = value;
                                            }
                                        }
                                    }
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error running performance tests: ${error.message}`, true);
                            })
                            .finally(() => {
                                button.disabled = false;
                            });
                    }

                    document.getElementById('import-data-btn').addEventListener('click', function() {
                        this.disabled = true;
                        addProgressMessage('Importing data...');
                        
                        fetch('/import_data')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error importing data: ${error.message}`, true);
                            })
                            .finally(() => {
                                this.disabled = false;
                            });
                    });

                    document.getElementById('run-workload-btn').addEventListener('click', function() {
                        this.disabled = true;
                        addProgressMessage('Running workload...');
                        
                        fetch('/run_workload')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error running workload: ${error.message}`, true);
                            })
                            .finally(() => {
                                this.disabled = false;
                            });
                    });

                    document.getElementById('visualize-data-btn').addEventListener('click', function() {
                        this.disabled = true;
                        addProgressMessage('Generating visualizations...');
                        
                        fetch('/visualize_data')
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    addProgressMessage(data.message);
                                    updateStatistics();
                                } else {
                                    addProgressMessage(data.message, true);
                                }
                            })
                            .catch(error => {
                                addProgressMessage(`Error generating visualizations: ${error.message}`, true);
                            })
                            .finally(() => {
                                this.disabled = false;
                            });
                    });
            </script>
        </div>
    </body>
    </html>
    